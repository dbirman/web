<!DOCTYPE HTML>
<!--
	Landed by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Evidence accumulation lab</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="../assets/css/main.css" />
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->

		<!-- Generics -->
			<script src="../assets/js/jquery.min.js"></script>
			<script src="../assets/js/math.min.js"></script>
			<script src="../assets/js/jquery.scrolly.min.js"></script>
			<script src="../assets/js/jquery.dropotron.min.js"></script>
			<script src="../assets/js/jquery.scrollex.min.js"></script>
			<script src="../assets/js/skel.min.js"></script>
			<script src="../assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="../assets/js/main.js"></script>
		<!-- Math KaTeX -->
			<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.css">
			<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.js"></script>
		<!-- Plotting: Plot.ly JS -->
      <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
	</head>
	<body>
		<div id="page-wrapper">

			<!-- Header -->
				<header id="header">
					<!-- <h1 id="logo"><a href="../index.html">Dan Birman</a></h1> -->
					<nav id="nav">
						<ul>
							<li><a href="../learn.html">Learn</a></li>
						</ul>
					</nav>
				</header>

			<!-- Main -->
				<div id="main" class="wrapper style1">
					<div class="container">
						<header class="major">
							<h2>Sensory Perception Lab</h2>
							<p>PSYCH 50</p>
						</header>

						<!-- Content -->
							<section id="content">
<div id="block1">
	<h2>Evidence accumulation lab</h2>
	<h1>Introduction</h1>
	<p>In this lab, we'll discuss how computational models are used in cognitive neuroscience, and we'll look at how one class of models, Drift Diffusion Models, is used to express and test hypotheses about visual perception.
	<h1>Learning goals</h1>
	After this lab you should have a better understanding of the following:
	<ul>
		<li>What models are, and how they are used in cognitive neuroscience</li>
		<li>How drift diffusion models (DDM) work, and what they capture about the decision making</li>
		<li>How to use models to make predictions about behavior</li>
	</ul>
	</p>
	<h1>What is a computational model?</h1>
	<p><b>Computation models</b> are abstract, mathematical descriptions that strip down the thing being described into its essential parts. You already learned about how simple cells, complex cells, and even deep neural networks can be a model for the human visual cortex. Now we want to introduce you to a new kind of model that can be used to help understand decision making. For example, the map of Stanford on your smartphone is a model of the Stanford campus: it gives you essential information about the campus that you need to navigate. Models are useful, first, because they condense complex, messy information into a simpler representation—if your map was instead exactly as large and detailed as the real Stanford campus, it would not help you get to class any faster. The same will be true of our decision making models, we will take complex information and boil it down to the minimum necessary to make a choice.</p>
	<p>You can think of computational models as a mathematical language for expressing theories. In fact, you may have already seen computational models in some of your other classes. For example, in your physics class, you may have seen the following equation used to describe the motion of a cannonball whizzing through the air:
	</p>
	<div style="text-align:center"><img src="images/human-cannonball.jpg"/></div>
	<div id="katex1"></div>
</div>

<div id="block2">
	<div id="katex2"></div>
	<p>We can use this equation to <b>model</b> the position of the cannonball over time. What you'll see below plotted in red is the actual positions of an imaginary cannonball. Your job is going to be to change the <b>parameters</b> of the model to best fit the data. After that we'll be able to <b>interpret</b> the parameters to understand what the cannonball was doing, and what forces were acting upon it.</p>
	<p><b>Hint:</b> whenever we provide code that can be edited, press <b>enter</b> to run the code including changes you made.</p>
	<p><b>Hint:</b> when you see <b>//</b> the rest of the text on that line doesn't get executed. We use this to provide you with <b>comments</b> about what indiviual variables mean.</p>
	<textarea id="textarea1" rows="7" onkeypress="textarea1(event,this);">
// Model Paramters: tweak to fit the black line (model) to the data (red)
y0 = 0; // Initial position (m)
vy = 10; // Vertical velocity (m/s)
ay = -1; // Vertical acceleration (gravity, m/s^2)</textarea><br>
	<p>The plot below solves the equation for values of t (time) using your parameters from zero to five seconds.</p>
	<div width=600 id="plot1"></div><br>
	<p id="leastsquares_visible1">Complete the task to continue!</p>
	<div id="leastsquares_hidden1"><p></p>
		<p>What you just did was use a computational model to attempt to explain a set of data. What you found was that by setting the initial velocity to 49 m/s and gravity -9.8 m/s^2 you were able to explain all of the datapoints we observed. An analgous way to say this would be to say: the cannonball left the cannon at 49 m/s, and over time gravity pulled it back to earth, ultimately the cannonball traveled in an <i>arc</i>.
		<p>Compare the statement <i>cannonballs travel in an arc</i> to the equation above. What advantages might the computational model have over the verbal model? All models make some simplifying assumptions—what details of the cannonball's trajectory does the equation neglect?</p>
		<p>Computational models are used throughout the sciences to explain and predict complex phenomena, such as the trajectory of a hurricane, the ups and downs of the stock market and, in cognitive neuroscience, the computations perfomed by the 100 billion neurons in your brain. In the remainder of this lab, we'll look at one particular class of models: <b>Drift Diffusion Models</b>.</p>
	</div>
</div>

<div id="block3">
	<h2>What are Drift Diffusion Models (DDMs)?</h2>
	<p>Drift Diffusion Models are a way of modeling rapid, noisy decisions between two alternatives. In class, you saw how these models are used to model some aspects of perception, such as motion detection. You might think that *seeing* is very different from *decision-making*—but, actually, your brain is constantly making split-second decisions to interpret what you are seeing. For example, just think of the many decisions you make while driving: your brain isn't hard-wired with "car detectors," but it can use information about the motion from other cars to infer whether you are going at the same speed as the other cars, whether you have enough room to change lanes, or how far away you are from your exit.</p>
	<p>In the lab, neuroscientists use much simpler decisions to study how these fast, complex perceptual decisions are made. In class, you saw one such experiment, carried out by Professor William Newsome's lab at Stanford: macaques were shown moving dots on a screen, and they had to decide whether the dots were predominantly moving to the left or to the right. The task was made harder or easier by changing the proportion of dots that were moving in concert:</p>
	<div width="100%" height="150px" style="position:relative; text-align:center">
		<div >25%<br><canvas width=100 height=100 id="canvas_mot25"></canvas></div>
		<div >50%<br><canvas width=100 height=100 id="canvas_mot50"></canvas></div>
		<div >75%<br><canvas width=100 height=100 id="canvas_mot75"></canvas></div>
	</div><br>
	<p>DDMs describe the macaque's perceptual decision-making, essentially, as a process where evidence is noisily accumulated in favor of one of two alternatives ("left" or "right"). What does it mean to accumulate evidence? Imagine that there is a decider neuron that is counting the "votes" cast by other, motion-detecting neurons. At each timestep, it reads a spike from a neuron that codes either leftward motion (casting one vote for "left") or rightward motion (casting one vote for "right"). This neuron continues to count votes until it accumulates enough evidence for one of the two options and makes its decision. You should have this image in mind, as we saw in lecture:</p>
	<div style="text-align:center"><img src="images/integrator.png"/></div>
	<p>We're going to model this picture in just a moment, but before you go on take a second to really study it. What do we mean by a "right preferring MT population"? This should remind you of last week's lab in which you learned about neurons that have preferences for different visual features, such as oriented bars, or complex features like cats and dogs. The neurons here just happen to prefer <b>rightward motion</b>.
</div>
<div id="block4">
	<h2>Problem #1: Simulating a single decision</h2>
	<p>You've already seen in the first lab how a cell can "see" certain kinds of features, even as complex as a dog or a cat, by building up from less complex features. Here what we're going to have are two <b>populations</b> of neurons that respond to rightward or leftward motion, respectively. Note that these aren't single neurons anymore, we're going to be imagining that this is a set of neurons that respond as a group. Below we're going to show you what this looks like. We'll generate a patch of motion and show you the output of the two populations of neurons. The left preferring neurons are drawn in blue, while the right preferring neurons in red. Note how as the amount of motion in the patch changes the populations becoming more or less certain in their output.</p>
	<div width="100%" height="150px" style="position:relative; text-align:center">
		<div><canvas width=100 height=100 id="motion_patch1"></canvas></div>
		<div><h1 style="color:blue">Left neurons</h1><h1 style="color:red">Right neurons</h1><br><canvas width=200 height=100 id="output1"></canvas></div>
	</div><br>
	<p>What should be clear from this demonstration is that given these two <b>neural</b> outputs, that at high motion coherence the brain can easily tell the direction of motion. But at low coherence it would be very hard to distinguish the direction. This model should match your own experience looking at the dot patch directly.</p>
	<p>As we mentioned before, a macaque (or human) brain looking at a patch of motion is trying to answer the question: what direction is the motion going? You've learned that different populations of neurons will <i>separately</i> report evidence for different answers. The last step is to combine those different sources of information together.</p>
</div>

<div id="block5">
	<h2>Problem #1: Simulating a single decision</h2>
	<p>We're now going to describe a computational model to combine two noisy sources of information together to try to reach a decision. To build up our model we're going to imagine that our macaque brain is looking at a motion patch for a few hundred milliseconds. This means that the populations of <i>left</i> and <i>right</i> preferring neurons will each be activated to some extent at every moment in time. Each population also has noise at any given moment, so it would be a mistake to take the instantenous response of either population as the truth. Instead we will combine the two sets of data by looking at the difference in their responses and <b>accumulating</b> those differences over time. If we wait long enough and <i>one population is, on average, more active</i> then eventually we will see that in the accumulated response.</p>
	<p>To picture what's happening take a look at this graph. In red and blue we have the responses of two populations of neurons that prefer <span style="color:blue">left</span> and <span style="color:red">right</span> motion. In black we plot the accumulate difference, calculated as follows:</p>
	<div id="katex3"></div>
	<p>To orient you, we're also going to show you the patch of the dots that this particular set of data were generated from. You can click the button to generate a new motion sample (and a new "run" of the data).
	<div width="100%" height="150px" style="position:relative; text-align:center">
		<div>
			<h1>Motion sample</h1><canvas width=100 height=100 id="sample"></canvas>
			<button class="button" onclick="resetSample();">Run new sample</button>
		</div>
	</div>
	<div width=600 id="plot2"></div><br><br>
	<p>There are a few things to note here. First, at a glance the red and blue lines really don't give you enough information to tell on their own whether any given motion is to the left or to the right. BUT--integrating this information (by summing it up over time, that is the black line) does! Second, even sometimes when the motion is quite obvious the model doesn't go in the right direction, this is of course because we've introduced <b>noise</b> into the model. Finally, you could imagine now adding one final step. What if you picked some value, a threshold, of evidence at which you would accept whatever decision the model had come to. For example, you could say that if you get to either +20 (left) or -20 (right), then you'll take that decision and use it. This would now give you the ability to use this miniature model to make decisions.</p>
	<p>What we've just shown you is the core of the drift diffusion model: a diffusion rate (the evidence for left minus the evidence for right), the drift rate (noise), and the threshold at which you make your choice. In the next section you're going to write some code to implement the model yourself, and then we'll use it to do some <b>simulations</b>.
</div>

<div id="block6">
	<h2>Problem #1: Simulating a single decision</h2>
	<p>It's now your turn to write some code! The first thing we're going to do is generate the neural population responses for any particular motion patch. We're going to give you two numbers: the coherence of the patch (what % of dots are moving together), and the direction. Your job is going to be to complete two <b>functions</b> that will tell us what the neural population response looks like based on what the neurons are seeing (the coherence and direction). Remember that neurons have some response, but they also have noise. We've written a function <b>randn()</b> that you can use to get random numbers pulled from a normal distribution. Try out randn() here: just press <b>enter</b>, you'll see the output of this function below.
	<textarea rows=1 id="textarea6" onkeypress="textarea6(event);">
out = randn();</textarea>
	<textarea color="red" rows=1 onkeypress="event.preventDefault();" id="output6">Output will appear here</textarea>
	<br>
	<p>Try pressing enter a few more times, you should see that the values you get are being taken from the random normal (gaussian) distribution, centered at 0 with a standard deviation of 1. If you're not familiar with normal distributions this is a good time to ask your neighbor, or the TA, to describe how these work.</p>
	<p>Now imagine that we have a motion patch that has some random coherence and direction. We'll store these values in the variables <b>patch_coherence</b> which can go from 0 to 1 and <b>patch_dir</b> which is either 1 (right) or -1 (left). Use these values to fill out the two functions below: leftResponse() and rightResponse(), so that they return the response of the neural population. Remember the response should be some function of the coherence, plus noise, i.e. as in this equation but where F() is a function that you can pick. (It's okay to use the coherence value directly, but keep in mind how large the neural responses are relative to the noise, you may want to add a scaling factor)</p>
	<div id="katex4"></div>
	<textarea rows=23 id="textarea62" onkeypress="textarea62(event);">
//We've set up the function definitions for you
//just fill in the code where we marked it
function leftResponse(patch_coherence,patch_dir) {
	// Some hints: since this is the left response it should depend on
	// whether the patch is actually going left or right
	// To make things depend on a value you can use a conditional 
	// statement. For example, if you do the following:
	// out = dir>0 ? 1 : 0
	// The english translation is: If dir>0 is true then: 1, otherwise: 0
	// Don't forget to use randn() to add noise!

	// MODIFY THE NEXT LINE
	out = ??YOUR CODE HERE??;

	return out;
}

function rightResponse(patch_coherence,patch_dir) {
	// MODIFY THE NEXT LINE
	out = ??YOUR CODE HERE??;

	return out;
}</textarea>
	<textarea rows=4 onkeypress="event.preventDefault();" id="output62">Output will appear here</textarea>
	<br>
	<div id="end6">
	<p>Nice work! You now have two functions leftResponse() and rightResponse() that you'll be able to re-use later. Right now we're going to use them to generate samples like in the graph on the last page. We'll then write one more function to integrate these, and then we'll have our drift-diffusion model!
	<br><br>
	<a class="button" width=150 height=15 onclick="bonus1();">Bonus content (not required)</a>
	<br>
	<div id="bonus1"><br>
		<h2>Bonus content: Function shapes</h2>
		<p>How do you think neurons actually respond to increasing motion coherence? Do you think it's linear, non-linear, exponential? Why? When you look at the output on the graph on the next page, try going back to this one and editing your functions to compare linear, exponential, and saturating non-linear functions of coherence. Which do you think is the most realistic? Is there anything in biology that would suggest one solution is more likely than the others? Discuss with your partner and the TA.</p>
	</div>
	</div>
</div>

<div id="block7">
	<h2>Problem #1: Simulating a single decision</h2>
	<p>We're missing two more pieces for our drift diffusion model. The first is that we need to <b>accumulate</b> the evidence over time and the second is that we need to stop accumulating when we hit the <b>threshold</b>. You'll write that code in this next section. If you realize you made a mistake on the previous page you'll be able to go back and edit those as soon as you finish writing the code on this page.</p>
	<textarea rows=32 id="textarea7" onkeypress="textarea7(event);">
// This first function needs to accumulate the difference between the left
// and right neural population responses, then add them to the previous response
// and store the result in out.
// 
// We've provided for you:
// left - the left population respnse
// right - the right population response
// acc - the current accumulated value
function accumulateDDM(left,right,acc) {
	var new_acc = ??YOUR CODE HERE??;

	return new_acc;
}

//This second function tests whether we've hit the thresold yet.
//It needs to return a boolean, either true or false.
//You can do this by making a comparison, for example:
// 1 > 0 returns the boolean true
// 1 < 0 returns the boolean false
// And you can combine booleans with && (and) or || (or)
// For example:
// 1 > 0 || 1 < 0, reads as "Is one greater than zero AND is one less than zero?"
// which would return false.
//
//This function should return 1 if we are above the threshold
//and -1 if we are below the negative threshold (-threshold)
//if neither of these are true, simply return 0.
function atThreshold(acc,threshold) {
	var dir = ??YOUR CODE HERE??;

	return dir;
}</textarea>
	<textarea rows=2 onkeypress="event.preventDefault();" id="output7">Output will appear here</textarea>
	<br>
	<div id="end7">
		<p>Fantastic work! It's time to see your code code in action! Below we are plotting the output of <b>your code</b> based on the motion coherence and direction of this dot patch. This should look familiar, if you did everything correctly it should look more or less like the plot we showed you earlier. If it doesn't look right it probably means you used difference constant factors (for example: your ratio of noise to population responses may be quite different from what we used). Feel free to tweak your numbers and your functions and go on when you're ready.
		<div width="100%" height="150px" style="position:relative; text-align:center">
			<div>
				<h1>Motion sample</h1><canvas width=100 height=100 id="sample2"></canvas>
				<button class="button" onclick="resetSample7();">Run new sample</button>
			</div>
		</div>
		<div width=600 id="plot3"></div>
	</div>
</div>

<div id="block8">
	<h2>Problem #2: Simulating many decisions</h2>
	<p>The drift diffusion model is most useful as a <b>simulation</b> of reality. Given some set of parameters: a drift rate, diffusion rate, and threshold, we can create all sorts of different scenarios for how a particular event might play out. In fact if we simulate a large number of repeated events, because of the noise in the model we will get slightly different results each time. But: on average with each set of parameters we'll get some number of trials that come out correct <b>hits</b> some number that are incorrect <b>misses</b> and also a piece of information we haven't discussed which is the <b>reaction time</b> on each trial.</p>
	<p>The first thing we'll do in this section is model a hundred trials and just look at the variability in results that we get. Try tweaking the evidence for left or right motion, changing the amount of noise, or changing the thresholds, you'll see the output as well as the percentage of hits, misses, and the distribution of reaction times. Check it out:</p>

	<p>
</div>

<div id="endblock">
	<h2>Tutorial complete!</h2>
</div>
							</section>
							<section id="continue">
								<a class="button special" onclick="prev();">Go back</a>
								<a class="button special" onclick="next();">Continue</a>
							</section>
						<!-- End Content -->
					</div>
				</div>

			<!-- Footer -->
				<footer id="footer">
					<ul class="copyright">
						<li>&copy; Dan Birman 2015-Present</li><li><a href="https://github.com/dbirman/web/" target="_blank">Code<a/></li>
					</ul>
				</footer>

		</div>
	</body>
		<!-- Local Assets -->
			<script src="dots.js"></script>
			<script src="shared_code.js"></script>
			<script src="psych50_ddm.js"></script>
			<!-- <link rel="stylesheet" href="psych50_ddm.css" /> -->

			<script>launch();</script>
</html>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-34324563-2', 'auto');
  ga('send', 'pageview');

</script>
